<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Oppenheimer</title>
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    * {margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif;}
    body {background: url('img/oppenheimer.jpg') no-repeat center center fixed; background-size: cover; position: relative;}
    body::before {content: ""; position: absolute; top:0; left:0; right:0; bottom:0; backdrop-filter: blur(15px); background-color: rgba(0,0,0,0.6); z-index: 0;}
    .container {position: relative; z-index: 1; display: flex; padding: 30px; color: white;}
    .poster {flex: 0 0 250px;}
    .poster img {width: 100%; border-radius: 10px; box-shadow: 0 0 20px black;}
    .info {flex: 1; margin-left: 30px;}
    .title {font-size: 3em; font-weight: bold;}
    .meta {margin-top: 5px; font-size: 1.1em; color: #ccc;}
    .genres {margin: 15px 0;}
    .genre {display: inline-block; background: #444; color: white; padding: 6px 10px; border-radius: 20px; font-size: 0.9em; margin: 3px;}
    .plot {margin: 20px 0; font-size: 1.2em; line-height: 1.6em; max-width: 800px;}
    .credits p {margin: 5px 0;}
    .rating {margin-top: 20px; font-size: 1.2em; color: gold;}
    .site-header .container {justify-content: space-between; align-items: center;}
    .site-header nav ul {list-style: none; display: flex; gap: 20px;}
    .site-header nav a {color: white; text-decoration: none; font-weight: bold;}
    section {padding: 40px; color: white; position: relative; z-index: 1; max-width: 1200px; margin: auto;}
    #messages {height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; color: white; margin-bottom: 10px; background: rgba(0,0,0,0.5); border-radius: 8px;}
    #message-form {display: flex; gap: 10px; flex-wrap: wrap;}
    #message-form input[type="text"] {padding: 10px; border-radius: 5px; border: none; flex-grow: 1; min-width: 150px;}
    .message {background: rgba(255, 255, 255, 0.1); padding: 8px 12px; border-radius: 10px; margin-bottom: 8px; word-wrap: break-word; display: flex; gap: 10px; align-items: center;}
    .username-link {color: purple; font-weight: bold; cursor: pointer; text-decoration: underline; flex-shrink: 0;}
  </style>
</head>
<body>

  <header class="site-header">
    <div class="container">
      <h1>CineMatch</h1>
      <nav>
        <ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="peliculas.html" class="active">Películas</a></li>
          <li><a href="series.html">Series</a></li>
          <li><a href="perfil.html">Mi Perfil</a></li>
          <li><a href="login.html" class="btn-login">Iniciar sesión</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="container">
    <div class="poster">
      <img src="img/oppenheimer.jpg" alt="Oppenheimer Poster" />
    </div>
    <div class="info">
      <div class="title">Oppenheimer</div>
      <div class="meta">2023 · B15 · 3h</div>

      <div class="genres">
        <span class="genre">Biografía</span>
        <span class="genre">Drama</span>
        <span class="genre">Histórica</span>
      </div>

      <div class="plot">
        La historia del físico J. Robert Oppenheimer y su papel como desarrollador de la bomba atómica durante la Segunda Guerra Mundial.
      </div>

      <div class="credits">
        <p><strong>Dirección:</strong> Christopher Nolan</p>
        <p><strong>Guionistas:</strong> Christopher Nolan, basado en el libro "American Prometheus"</p>
        <p><strong>Elenco:</strong> Cillian Murphy, Emily Blunt, Matt Damon, Robert Downey Jr., Florence Pugh</p>
      </div>

      <div class="rating">⭐ 8.7/10</div>
    </div>
  </div>

  <div style="padding: 40px; color: white; position: relative; z-index: 1; max-width: 1200px; margin: auto;">
    <div style="background: #f5c518; color: black; padding: 10px 20px; font-weight: bold; border-radius: 5px; width: fit-content; margin-bottom: 30px;">
      Premios: Ganadora de 7 premios Oscar y 228 galardones en total
    </div>

    <h2>Videos</h2>
    <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 30px;">
      <iframe width="300" height="170" src="https://www.youtube.com/embed/uYPbbksJxIg" title="Trailer Oficial Oppenheimer" frameborder="0" allowfullscreen></iframe>
      <iframe width="300" height="170" src="https://www.youtube.com/embed/bK6ldnjE3Y0" title="Trailer IMAX" frameborder="0" allowfullscreen></iframe>
      <iframe width="300" height="170" src="https://www.youtube.com/embed/F3OxA9Cz17A" title="Featurette" frameborder="0" allowfullscreen></iframe>
    </div>

    <h2>Fotos</h2>
    <div style="display: flex; gap: 15px; overflow-x: auto; margin-bottom: 30px;">
      <img src="https://m.media-amazon.com/images/M/MV5BYzY1ZDY4ZTAtNDliYi00ZmNjLWI0ZTQtYjRlNzI3NGI2MWQ4XkEyXkFqcGdeQXVyMTAxNjYyNjYz._V1_.jpg" style="height: 120px; border-radius: 5px;" />
      <img src="https://m.media-amazon.com/images/M/MV5BNjNjNzA0NjAtYTc1Ny00YjRjLWIyMjctZTA3OGZlNGM5ZmViXkEyXkFqcGdeQXVyMjI3NDAyNg@@._V1_.jpg" style="height: 120px; border-radius: 5px;" />
      <img src="https://m.media-amazon.com/images/M/MV5BNGVhM2ZhYjgtMTRkOC00N2M1LThjN2YtNzU3MzZhMThlNTMzXkEyXkFqcGdeQXVyNjc5Mjg3NzU@._V1_.jpg" style="height: 120px; border-radius: 5px;" />
    </div>

    <h2>Califica esta película</h2>
    <div id="rating-stars" style="font-size: 2rem; cursor: pointer;">
      <span data-star="1">☆</span>
      <span data-star="2">☆</span>
      <span data-star="3">☆</span>
      <span data-star="4">☆</span>
      <span data-star="5">☆</span>
    </div>
    <p id="rating-result" style="margin: 10px 0;"></p>

    <h2>Comentarios</h2>
    <div id="messages"></div>
    <form id="message-form" autocomplete="off">
      <input type="text" id="message" placeholder="Escribe un comentario" required />
      <button type="submit">Enviar</button>
    </form>
  </div>

  <footer class="site-footer">
    <div class="container">
      <p>© 2025 CineMatch. Todos los derechos reservados.</p>
      <p>
        <a href="terminos.html">Términos y condiciones</a> |
        <a href="privacidad.html">Política de privacidad</a>
      </p>
    </div>
  </footer>

<script>
  const registeredUsername = localStorage.getItem('loggedUser') || "UsuarioAnonimo";
  const form = document.getElementById("message-form");
  const messagesDiv = document.getElementById("messages");

  // Cargar mensajes guardados en localStorage (si hay)
  function loadMessages() {
    const stored = localStorage.getItem('chatMessages');
    if (!stored) return [];
    try {
      return JSON.parse(stored);
    } catch {
      return [];
    }
  }

  // Guardar mensajes en localStorage
  function saveMessages(messages) {
    localStorage.setItem('chatMessages', JSON.stringify(messages));
  }

  // Renderizar mensajes en el div
  function renderMessages(messages) {
    messagesDiv.innerHTML = "";
    messages.forEach(({ username, text }) => {
      const messageElem = document.createElement("div");
      messageElem.classList.add("message");

      const userLink = document.createElement("a");
      userLink.textContent = username;
      userLink.href = `perfil.html?user=${encodeURIComponent(username)}`;
      userLink.classList.add("username-link");
      userLink.title = `Ver perfil de ${username}`;
      userLink.target = "_blank";

      const textSpan = document.createElement("span");
      textSpan.textContent = ": " + text;

      messageElem.appendChild(userLink);
      messageElem.appendChild(textSpan);
      messagesDiv.appendChild(messageElem);
    });
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  // Inicializa mostrando mensajes existentes
  let chatMessages = loadMessages();
  renderMessages(chatMessages);

  // Manejar nuevo mensaje
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const messageInput = document.getElementById("message");
    const messageText = messageInput.value.trim();
    if (messageText === "") return;

    const newMessage = { username: registeredUsername, text: messageText };
    chatMessages.push(newMessage);
    saveMessages(chatMessages);
    renderMessages(chatMessages);

    messageInput.value = "";
    messageInput.focus();
  });

  // Escuchar cambios en localStorage desde otras pestañas (para "chat en tiempo real")
  window.addEventListener('storage', (event) => {
    if (event.key === 'chatMessages') {
      chatMessages = loadMessages();
      renderMessages(chatMessages);
    }
  });
</script>
<script>
  const stars = document.querySelectorAll('.rating-stars .star');
  let selectedRating = 0;

  stars.forEach((star, index) => {
    star.addEventListener('mouseover', () => {
      highlightStars(index);
    });

    star.addEventListener('mouseout', () => {
      highlightStars(selectedRating - 1);
    });

    star.addEventListener('click', () => {
      selectedRating = index + 1;
      highlightStars(index);
      console.log("Rating seleccionado:", selectedRating);
      // Aquí puedes guardar en localStorage o enviarlo a tu servidor
    });
  });

  function highlightStars(index) {
    stars.forEach((star, i) => {
      star.classList.toggle('hover', i <= index);
      star.classList.toggle('selected', i <= index);
    });
  }
const ratingStars = document.getElementById("rating-stars");
const ratingResult = document.getElementById("rating-result");

function updateStarsDisplay(score) {
  const starSpans = ratingStars.querySelectorAll("span");
  starSpans.forEach((span, i) => {
    span.textContent = (i < score) ? "★" : "☆";
  });

  ratingResult.textContent = score > 0
    ? `Tu calificación: ${score} estrella${score > 1 ? "s" : ""}`
    : "Tu calificación: No has calificado aún";
}

function getStoredRating(user) {
  const ratings = JSON.parse(localStorage.getItem("movieRatings") || "{}");
  return ratings[user] || 0;
}

function saveRating(user, rating) {
  const ratings = JSON.parse(localStorage.getItem("movieRatings") || "{}");
  ratings[user] = rating;
  localStorage.setItem("movieRatings", JSON.stringify(ratings));
}

// Asegúrate de que esta variable exista en tu entorno
let currentRating = getStoredRating(registeredUsername);
updateStarsDisplay(currentRating);

// Manejo de clic en estrellas
ratingStars.addEventListener("click", (e) => {
  if (e.target.tagName === "SPAN") {
    const selectedStars = parseInt(e.target.getAttribute("data-star"));
    currentRating = selectedStars;
    updateStarsDisplay(currentRating);
    saveRating(registeredUsername, currentRating);
  }
});


</script>

</body>
</html>
